<html>
<body>
<style>* {padding: 0; margin: 0}</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.16.1/vis.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.16.1/vis.min.js"></script>
<script src="https://cpettitt.github.io/project/graphlib-dot/v0.4.10/graphlib-dot.min.js"></script>
<script src="data/geocode.js"></script>
<div id="graph"></div>
<script>
let network;

(function() {
const GRAPH_FILE = 'https://raw.githubusercontent.com/wesalvaro/tokyo-dot/master/tokyo.dot';

d3.text(GRAPH_FILE, function(e, dot) {
  if (e) throw e;
  const graph = graphlibDot.parse(dot);

  const nodes = [];
  graph.eachNode(function(id, node) {
    node.id = id;
    const splits = node.label.split('|')[0].split('{{');
    node.label = splits[splits.length - 1];
    node.shape = 'box';
    node.group = id.match(/^[A-Z]+/)[0];
    [node.x, node.y] = getXY(id);
    nodes.push(node);
  });

  const edges = [];
  graph.eachEdge(function(id, from, to, edge) {
    edge.dashes = Boolean(edge.style == 'dashed');
    edge.from = from;
    edge.to = to;
    edges.push(edge);
  });

  const data = {
    nodes: nodes,
    edges: edges
  };
  const options = {
    nodes: {
      shape: 'box',
      size: 10,
      font: {
        size: 22,
        color: '#fff',
      },
      borderWidth: 2,
    },
    edges: {
      width: 2,
    },
  };
  network = new vis.Network(document.getElementById('graph'), data, options);
  network.on('startStabilizing', () => {
    // Stop the drifting!
    setTimeout(() => network.stopSimulation(), 7000);
  });
});

}());
</script>
</body>
</html>
